# Credit Operations

## **Wallet Credit <font color="green">POST</font>** 

**Request URL:** https://api.paycaddy.dev/v1/WalletCredits

The creation of a credit wallet is done through a POST call that carries the following structure:

=== "Request"
    ```json
    {
        "userId": "string",
        "currency": "string",
        "description": "string",
        "time": 0,
        "limit": 0,
        "firstCutDate": "2024-08-06T09:48:23.648Z",
        "creditProductCode": "string"
    }
    ```
=== "Response"
    ```json
    {
        "id": "string",
        "userId": "string",
        "currency": "USD",
        "description": "string",
        "limit": 0,
        "creationDate": "2024-07-30T07:26:52.9871618+00:00"
    }
    ```

This call must be made by associating it with a previously created active **userId**.

The **“currency”** field must consider ISO 4217 codes. (For example, US Dollars would be entered with the code "USD").

The **"description"** field is used to name the wallet according to its intended use, but is not mandatory for creating a new wallet.

The **"time"** field defines the number of days that the credit line must remain active. This field is used to define the term of a revolving credit **(see [ReportPayCredit](#report-pay-credit-post))**. If this field is omitted, the resulting revolving wallet will remain indefinitely active until manual cancellation.

The **"limit"** field sets the credit limit amount in cents that the wallet will have per month.

The **“firstCutDate”** is a timestamp value in format ISO 8601, that defines when the credit line will be regenerated and according to the **creditProductCode** specs, will generate the necessary charges.

Finally, the **creditProductCode** is a previously generated by PayCaddy’s team  3-numbers code that specifies the rules for the credit line that will be set for this new wallet.

---

## **Wallet Credit <font color="sky-blue">GET</font>** 

**Request URL:** https://api.paycaddy.dev/v1/WalletCredits/

The GET call for credit wallets allows you to retrieve the information associated with the queried walletId. This call is particularly important for checking the available balance in a wallet, the balance withheld due to pending transactions, internal wallet limits and the amount spent during the month.

=== "Request"
    ```json
    https://api.paycaddy.dev/v1/WalletCredits/{WALLET_ID}
    ``` 

=== "Response"
    ```json
    {
        "id": "string",
        "userId": "string",
        "currency": "string",
        "description": "string",
        "limit": 0,
        "amountOwed": 0,
        "interestOwed": 0,
        "amountAvailable": 0,
        "creationDate": "2024-11-12T12:48:39.573Z"
    }
    ``` 
    
The **total balance** is reflected in the "balance" field of the successful 200 response to this call, while the **balance withheld** is reflected in the **"amountWithheld"** field.

All amounts are reflected in cents, meaning USD 1,000.00 would be represented as 100000.

To a recently created wallet, the fields **internalWalletLimit** and **amountSpentMonth** comes by default with value 0.  To change the **internalWalletLimit** check **[Change Internal Wallet Limit POST](wallet.en.md#change-internal-card-limit-post).**

The call may fail if an incorrect walletId is provided, in which case the NeoBank API would respond with a HTTP 400 error.

```json
    {
        "type": "",
        "title": "Wallet 'c4d165d1-xxxx-xxxx-xxxx-017f0c6facf8' not found",
        "status": 0,
        "detail": "",
        "instance": ""
    }
```

---

## **Report Pay Credit <font color="green">POST</font>** 

**Request URL:** https://api.paycaddy.dev/v1/reportPayCredits

The ReportPayCredit endpoint is aimed to users who have an active credit line, the payment value can either be corresponding or parcial, on this case generating debtor interests, to total debt in order to restore credit through his walletId. 

The reported value for amountToCapital will be used to pay off the debtor and nominal debts. The amount for each is determined considering the split value from creditProduct related to the walletId.

=== "Request"
    ```json
    {
        "walletId": "string",
        "amountToCapital": 0,
        "currency": "string",
        "statement": "string"
    }
    ```
=== "Response"
    ```json
    {
        "creationDate": "2024-08-07T15:52:55.407Z",
        "limit": "string",
        "amountAvailable": "string"
    }
    ```

The field called **amountToCapital** determines the amount that the user is reporting, which will have an impact on the available amount, by the user within the credit line.
The **currency** field corresponds to the currency of the wallet. The **statement** field will be used to leave a brief description of the operation performed.

If successful, the payment report will be generated with the specified data, and the call will return a HTTP 200 detailing the date on which the report was made, as well as the amount of the wallet’s limit and the available balance. Also a webhook notification is send **(see [notificationEnlist](prefundedTRX.en.md#notification-enlist-post))** to inform the report and its effects. 

Otherwise, the NeoBank API will respond with an HTTP 422 error. The most common errors may include:

- Invalid or non-credit **walletId**.
- Currency value does not match the original currency of the wallet.
- **amountToCapital** greater than amount owed.

---

## **Report Pay Credit Capital <font color="green">POST</font>** 

**Request URL:** https://api.paycaddy.dev/v1/ReportPayCreditsCapital

The **ReportPayCreditCapital** endpoint is used by users who have an active credit line. It expect either a corresponding or parcial payment , in parcial cases generating debtor interests, in order to restore credit through his **walletId**. 

This endpoint doesn’t consider the **split** value from the creditProductCode **(see [changeInterestCapital](#change-interest-credit-capital-post))**, once it only discount the reported amount from the **amountOwed**, it doesn’t consider if the wallet is on debt and has debtor interest executed not payed.

=== "Request"
    ```json
    {
        "walletId": "string",
        "amountToCapital": 0,
        "currency": "string",
        "statement": "string"
    }
    ```
=== "Response"
    ```json
    {
        "creationDate": "2024-08-07T11:28:37.022Z",
        "limit": "string",
        "amountAvailable": "string"
    }
    ```

The field called **amountToCapital** determines the amount that the user is reporting, which will have an impact on the available amount, by the user within the credit line.

The **currency** field corresponds to the currency of the wallet. 

The **statement** field will be used to leave a brief description of the operation performed.

If successful, the payment report will be generated with the specified data, and the call will return an HTTP 200 detailing the date on which the report was made, as well as the values of the card limit and the available balance. Also a webhook notification is send **(see [notificationEnlist](prefundedTRX.en.md#notification-enlist-post))** to inform the report and its effects.

Otherwise, the NeoBank API will respond with a HTTP 422 error. The most common errors may include:

- Invalid or non-credit **walletId**.
- Currency value does not match the original currency of the wallet.
- **amountToCapital** greater than amount owed.

---

## **Change Wallet Limit <font color="green">POST</font>** 

**Request URL:** https://api.paycaddy.dev/v1/WalletCredits/ChangeWalletLimit

This method will be used to modify the limits previously established in the credit wallets of PayCaddy API users. The limit can only be increased because of accountable matters.

=== "Request"
    ```json
    {
        "walletId": "string",
        "newLimit": 0,
        "currency": "string",
        "statement": "string"
    }
    ```
=== "Response"
    ```json
    {
        "walletId": "string",
        "newLimit": 0
    }
    ```

The call will be associated with the provided 'walletId', followed by the value entered in the 'newLimit' field, which will represent the amount that needs to be updated in the 'limit' property of the wallet.

The 'currency' field must correspond to the 'currency' property of the indicated wallet, and finally, the 'statement' field provides a brief description of the operation performed.

All amounts are reflected in cents, meaning USD 1,000.00 would be represented as 100000.

The call may fail if an incorrect walletId is provided or a smaller value is sented in **newLimit**, in which case the PayCaddy API would respond with a HTTP 400 error.

---
## **Change Interest Credit Capital <font color="green">POST</font>** 

**Request URL:** https://api.paycaddy.dev/v1/ChangeInterestCreditCapital

This endpoint fills the purpose of customize as you wish an instance of a credit product related to a specific wallet. You can change a lot of specifics properties from this credit product based on your own criteria. The description for each field is described on [credit products](creditFlow.en.md#credit-products) session.

Although, is required that the credit product allows this operation to happen. You can check it contacting PayCaddy's team to get this information, although we recommend that every credit product created should be documented and stored properly.

=== "Request"
    ```json
    {
		"walletId": "string",
		"interestRate": 0,
		"interestFixedAmount": 0,
		"morosidadRate": 0,
		"morosidadFixedAmount": 0,
		"minimumPaymentRate": 0,
		"minimumPaymentFixed": 0,
		"split": 0
    }
    ```
=== "Response"
    ```json
    {
		"walletId": "string",
		"interestRate": 0,
		"interestFixedAmount": 0,
		"morosidadRate": 0,
		"morosidadFixedAmount": 0,
		"minimumPaymentRate": 0,
		"minimumPaymentFixed": 0,
		"split": 0
    }
    ```

Only credit wallets are allowed to use this endpoint. If provided a debit wallet, the endpoint will respond with a HTTP 422 error. 

The API will also respond with the same error if the userId associated with it is block or inactive.
It is recommended to verify the status of the user associated prior to making the ChangeInterestCreditCapital call.

---
## **PayOut Credit <font color="green">POST</font>** 

**Request URL:** https://api.paycaddy.dev/v1/Credit/PayOutCredits

PayOut is a method to consume manually a credit line limit, its amount available to spent. Unlike regular transactions that won't ever cross the credit line limit, the pay out credit can keep incrementing the amount owed by the wallet, even if the wallet doesn't have any spare amount available.

Similar to a simple PayOut, the successfull response will return the entered data accompanied by a unique transaction identified and it's timestamp.

=== "Request"
    ```json
    {
		  "walletIdFrom": "string",
		  "amount": 0,
		  "currency": "string",
		  "statement": "string"
	}
    ```
=== "Response"
    ```json
    {
		    "id": "string",
		    "walletIdFrom": "string",
		    "amount": 0,
		    "currency": "string",
		    "statement": "string",
		    "creationDate": "string"
	}
    ```

Only credit wallets are allowed to use this endpoint. If provided a debit wallet, the endpoint will respond with a HTTP 422 error. 

The API will also respond with the same error if the userId associated with it is block or inactive.
It is recommended to verify the status of the user associated prior to making the PayOutCredit POST call.

---
## **Check Credit Operation <font color="sky-blue">GET</font>** 

**Request URL:** https://api.paycaddy.dev/v1/CheckCredit/

The CheckCreditOperation GET call allows for retrieving information about a queried **'walletId'**. This call is especially important for checking the activity status of the wallet.

If successful, the call will return an HTTP 200 detailing the associated 'walletId' and the status of the wallet."

=== "Request"
    ```json
    https://api.paycaddy.dev/v1/CheckCredit/{WALLET_ID}
    ```
=== "Response"
    ```json
    {
        "walletId": "string",
        "status": "string"
    }
    ```

The value of the 'status' attribute can be:

- **True** if the wallet is activated and available for transactions.
- **False** if it is blocked, either by the system or due to non-payment (see [ReportPayCredit](#report-pay-credit-post)).
